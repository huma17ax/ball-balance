webpackJsonp([1],{"3EuY":function(t,i){},"4NA7":function(t,i){},"6O74":function(t,i){},"8v7q":function(t,i){},JrGn:function(t,i){},NHnr:function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=e("7+uW"),a={render:function(){var t=this.$createElement,i=this._self._c||t;return i("div",{attrs:{id:"app"}},[i("router-view")],1)},staticRenderFns:[]};var h=e("VU/8")({name:"App"},a,!1,function(t){e("JrGn")},null,null).exports,o=e("/ocq"),r=e("Dd8w"),n=e.n(r),l=e("BO1k"),p=e.n(l),c=e("NYxO"),m={name:"Ball",data:function(){return{pos:{x:0,y:0},velocity:{x:0,y:0},keyForce:240,friction:96,repulsion:.5,collisionPoint:10,pressedKey:{}}},computed:n()({},Object(c.c)("manager",["deltaTime","updateFlg","screenWidth","screenHeight","mapchips","mapWidth","mapHeight","startPos","controllType","gyro","isAvailableGyro","tileEffectQueue"]),Object(c.b)("manager",["mapchipSize"]),{posStyle:function(){return{top:"calc("+this.pos.y+"% - "+this.ballSize/2+"px)",left:"calc("+this.pos.x+"% - "+this.ballSize/2+"px)"}},ballSize:function(){return this.mapchipSize/2}}),watch:{startPos:function(){this.pos.x=100*(this.startPos.x+.5)/this.mapWidth,this.pos.y=100*(this.startPos.y+.5)/this.mapHeight}},methods:{dotsStyle:function(t,i){return{top:"calc("+i+"% - 2px)",left:"calc("+t+"% - 2px)"}},Rec2Pol:function(t,i){var e=Math.sqrt(Math.pow(t,2)+Math.pow(i,2)),s=Math.atan(i/t);return t<0&&(s+=Math.PI),t>=0&&i<0&&(s+=2*Math.PI),{c:e,deg:s}},Pol2Rec:function(t,i){return{x:t*Math.cos(i),y:t*Math.sin(i)}},run:function(){var t={x:0,y:0};"keyboard"===this.controllType&&(this.pressedKey.DownArrow&&(t.y+=this.keyForce),this.pressedKey.UpArrow&&(t.y-=this.keyForce),this.pressedKey.LeftArrow&&(t.x-=this.keyForce),this.pressedKey.RightArrow&&(t.x+=this.keyForce)),"gyro"===this.controllType&&!0===this.isAvailableGyro&&(t.x+=this.keyForce*this.gyro.gamma/90,t.y+=this.keyForce*this.gyro.beta/90);for(var i=-1;i<2;i++)for(var e=-1;e<2;e++){var s=Math.floor(this.pos.y/100*this.mapHeight),a=Math.floor(this.pos.x/100*this.mapWidth);s+i>=0&&a+e>=0&&s+i<this.mapHeight&&a+e<this.mapWidth&&"BAN"===this.mapchips[s+i][a+e]&&Math.pow(this.mapchipSize*(s+i+.5)-this.pos.y/100*this.mapHeight*this.mapchipSize,2)+Math.pow(this.mapchipSize*(a+e+.5)-this.pos.x/100*this.mapWidth*this.mapchipSize,2)<Math.pow(this.mapchipSize/2+this.ballSize/2,2)&&(console.log("ban"),t.y+=5*(this.mapchipSize*(s+i+.5)-this.pos.y/100*this.mapHeight*this.mapchipSize),t.x+=5*(this.mapchipSize*(a+e+.5)-this.pos.x/100*this.mapWidth*this.mapchipSize))}if(0!==this.velocity.x||0!==this.velocity.y){var h=Math.sqrt(Math.pow(this.velocity.x,2)+Math.pow(this.velocity.y,2));t.x-=this.friction*this.velocity.x/h,t.y-=this.friction*this.velocity.y/h}var o=this.velocity.x+t.x*this.deltaTime,r=this.velocity.y+t.y*this.deltaTime;o*this.velocity.x<0&&r*this.velocity.y<0||o*this.velocity.x<0&&0===r&&0===this.velocity.y||0===o&&0===this.velocity.x&&r*this.velocity.y<0?(this.velocity.x=0,this.velocity.y=0):(this.velocity.x=o,this.velocity.y=r);var n=100/this.mapHeight*this.ballSize/this.mapchipSize/2,l=100/this.mapWidth*this.ballSize/this.mapchipSize/2,p=this.pos.x,c=this.pos.y-n;"WALL"===this.mapchips[Math.floor(c/100*this.mapHeight)][Math.floor(p/100*this.mapWidth)]&&(this.pos.y=100*(Math.floor(c/100*this.mapHeight)+1)/this.mapHeight+n,this.velocity.y=-this.velocity.y*this.repulsion,this.tileEffectQueue.push({act:"clp",y:Math.floor(c/100*this.mapHeight),x:Math.floor(p/100*this.mapWidth),at:{x:p/100*this.mapWidth-Math.floor(p/100*this.mapWidth),y:1},strg:Math.abs(this.velocity.y)}));var m=this.pos.x,d=this.pos.y+n;"WALL"===this.mapchips[Math.floor(d/100*this.mapHeight)][Math.floor(m/100*this.mapWidth)]&&(this.pos.y=100*Math.floor(d/100*this.mapHeight)/this.mapHeight-n,this.velocity.y=-this.velocity.y*this.repulsion,this.tileEffectQueue.push({act:"clp",y:Math.floor(d/100*this.mapHeight),x:Math.floor(m/100*this.mapWidth),at:{x:p/100*this.mapWidth-Math.floor(p/100*this.mapWidth),y:0},strg:Math.abs(this.velocity.y)}));var u=this.pos.x-l,f=this.pos.y;"WALL"===this.mapchips[Math.floor(f/100*this.mapHeight)][Math.floor(u/100*this.mapWidth)]&&(this.pos.x=100*(Math.floor(u/100*this.mapWidth)+1)/this.mapWidth+l,this.velocity.x=-this.velocity.x*this.repulsion,this.tileEffectQueue.push({act:"clp",y:Math.floor(f/100*this.mapHeight),x:Math.floor(u/100*this.mapWidth),at:{x:1,y:f/100*this.mapHeight-Math.floor(f/100*this.mapHeight)},strg:Math.abs(this.velocity.x)}));var y=this.pos.x+l,g=this.pos.y;"WALL"===this.mapchips[Math.floor(g/100*this.mapHeight)][Math.floor(y/100*this.mapWidth)]&&(this.pos.x=100*Math.floor(y/100*this.mapWidth)/this.mapWidth-l,this.velocity.x=-this.velocity.x*this.repulsion,this.tileEffectQueue.push({act:"clp",y:Math.floor(g/100*this.mapHeight),x:Math.floor(y/100*this.mapWidth),at:{x:0,y:f/100*this.mapHeight-Math.floor(f/100*this.mapHeight)},strg:Math.abs(this.velocity.x)}));var v=this.pos.x/100*this.mapWidth-Math.floor(this.pos.x/100*this.mapWidth)-.5,w=this.pos.y/100*this.mapHeight-Math.floor(this.pos.y/100*this.mapHeight)-.5,x=100*Math.floor(this.pos.x/100*this.mapWidth)/this.mapWidth+(v>0?100/this.mapWidth:0),S=100*Math.floor(this.pos.y/100*this.mapHeight)/this.mapHeight+(w>0?100/this.mapHeight:0),W="WALL"===this.mapchips[Math.floor(this.pos.y/100*this.mapHeight)+(w<0?-1:1)][Math.floor(this.pos.x/100*this.mapWidth)+(v<0?-1:1)];if(W=(W=W&&"WALL"!==this.mapchips[Math.floor(this.pos.y/100*this.mapHeight)][Math.floor(this.pos.x/100*this.mapWidth)+(v<0?-1:1)])&&"WALL"!==this.mapchips[Math.floor(this.pos.y/100*this.mapHeight)+(w<0?-1:1)][Math.floor(this.pos.x/100*this.mapWidth)]){var A=this.mapchipSize*this.mapWidth*x/100,L=this.mapchipSize*this.mapHeight*S/100,M=this.mapchipSize*this.mapWidth*this.pos.x/100,b=this.mapchipSize*this.mapHeight*this.pos.y/100;if(Math.sqrt(Math.pow(A-M,2)+Math.pow(L-b,2))<this.ballSize/2){var z=this.Rec2Pol(this.mapchipSize*this.mapWidth*(this.pos.x-x)/100,this.mapchipSize*this.mapHeight*(this.pos.y-S)/100),H=this.Pol2Rec(this.ballSize/2+1,z.deg);if(this.pos.x=x+H.x/this.mapchipSize/this.mapWidth*100,this.pos.y=S+H.y/this.mapchipSize/this.mapHeight*100,this.tileEffectQueue.push({act:"clp",y:Math.floor(this.pos.y/100*this.mapHeight)+(w<0?-1:1),x:Math.floor(this.pos.x/100*this.mapWidth)+(v<0?-1:1),at:{x:v<0?1:0,y:w<0?1:0},strg:this.Rec2Pol(this.velocity.x,this.velocity.y).c}),0!==this.velocity.x&&0!==this.velocity.y){var E=this.Rec2Pol(this.velocity.x,this.velocity.y);H=this.Pol2Rec(E.c,E.deg-z.deg),E=this.Rec2Pol(-H.x*this.repulsion,H.y),H=this.Pol2Rec(E.c,E.deg+z.deg),this.velocity.x=H.x,this.velocity.y=H.y}}}this.pos.x+=this.velocity.x/2/this.mapWidth*this.deltaTime,this.pos.y+=this.velocity.y/2/this.mapHeight*this.deltaTime,"BAN"===this.mapchips[Math.floor(this.pos.y/100*this.mapHeight)][Math.floor(this.pos.x/100*this.mapWidth)]&&Math.pow(this.mapchipSize*(Math.floor(this.pos.y/100*this.mapHeight)+.5)-this.pos.y/100*this.mapHeight*this.mapchipSize,2)+Math.pow(this.mapchipSize*(Math.floor(this.pos.x/100*this.mapWidth)+.5)-this.pos.x/100*this.mapWidth*this.mapchipSize,2)<Math.pow(this.mapchipSize/2,2)&&this.$store.dispatch("manager/setGameOver",!0),"GOAL"===this.mapchips[Math.floor(this.pos.y/100*this.mapHeight)][Math.floor(this.pos.x/100*this.mapWidth)]&&this.$store.dispatch("manager/setGameClear",!0)},KeyDown:function(t){40===t.keyCode&&(this.pressedKey.DownArrow=!0),38===t.keyCode&&(this.pressedKey.UpArrow=!0),39===t.keyCode&&(this.pressedKey.RightArrow=!0),37===t.keyCode&&(this.pressedKey.LeftArrow=!0)},KeyUp:function(t){40===t.keyCode&&(this.pressedKey.DownArrow=!1),38===t.keyCode&&(this.pressedKey.UpArrow=!1),39===t.keyCode&&(this.pressedKey.RightArrow=!1),37===t.keyCode&&(this.pressedKey.LeftArrow=!1)}},mounted:function(){window.addEventListener("keydown",this.KeyDown),window.addEventListener("keyup",this.KeyUp)}},d={render:function(){var t=this.$createElement,i=this._self._c||t;return i("div",[i("div",{staticClass:"ball",style:[this.posStyle,{height:this.ballSize+"px",width:this.ballSize+"px"}]})])},staticRenderFns:[]};var u=e("VU/8")(m,d,!1,function(t){e("4NA7")},"data-v-1a4678aa",null).exports,f={name:"Tile",props:["attr"],data:function(){return{wallEffectQueue:[]}},computed:n()({},Object(c.c)("manager",["mapImgs","tileEffectQueue"]),Object(c.b)("manager",["mapchipSize"]),{tileSize:function(){return{width:this.mapchipSize+"px",height:this.mapchipSize+"px"}},tileType:function(){return this.mapImgs[this.attr.pos_r][this.attr.pos_c]}}),methods:{run:function(){for(var t=0;t<this.wallEffectQueue.length;){var i=this.wallEffectQueue[t];console.log(i.strg),i.time>100*i.strg?this.wallEffectQueue.splice(t,1):(i.time++,t++)}for(var e=0;e<this.tileEffectQueue.length;){var s=this.tileEffectQueue[e];"clp"===s.act&&s.x===this.attr.pos_c&&s.y===this.attr.pos_r&&s.strg/250>.05?(this.wallEffectQueue.push({at:s.at,time:0,strg:s.strg/250}),this.tileEffectQueue.splice(e,1)):e++}},wallStyle:function(t){return{background:"radial-gradient(circle at "+100*this.wallEffectQueue[t].at.x+"% "+100*this.wallEffectQueue[t].at.y+"%, rgba(0, 255, 127, 0) "+(this.wallEffectQueue[t].time-5)+"%, rgba(0, 255, 127, "+(1-this.wallEffectQueue[t].time/(100*this.wallEffectQueue[t].strg))+") "+this.wallEffectQueue[t].time+"%, rgba(0, 255, 127, 0) "+(this.wallEffectQueue[t].time+5)+"%)"}}}},y={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"wrapper"},["wall1"==t.tileType?e("div",{staticClass:"wall",style:[t.tileSize]},t._l(t.wallEffectQueue,function(i,s){return e("div",{key:i.id,staticClass:"wall-in",style:t.wallStyle(s)})}),0):t._e(),t._v(" "),"air1"==t.tileType?e("div",{staticClass:"air",style:t.tileSize}):t._e(),t._v(" "),"ban1"==t.tileType?e("div",{staticClass:"ban",style:t.tileSize}):t._e(),t._v(" "),"goal1"==t.tileType?e("div",{staticClass:"goal",style:t.tileSize}):t._e()])},staticRenderFns:[]};var g={name:"flame",components:{ball:u,tile:e("VU/8")(f,y,!1,function(t){e("SCpU")},"data-v-6b81233c",null).exports},data:function(){return{}},methods:{run:function(){this.$refs.ball.run();var t=!0,i=!1,e=void 0;try{for(var s,a=p()(this.$refs.tile);!(t=(s=a.next()).done);t=!0){s.value.run()}}catch(t){i=!0,e=t}finally{try{!t&&a.return&&a.return()}finally{if(i)throw e}}},mapchipStyle:function(t,i){var e=this.mapImgs[t][i],s={width:this.mapchipSize+"px",height:this.mapchipSize+"px"};return"black"===e&&(s["background-color"]="black",s.border="solid 3px springgreen"),"white"===e&&(s["background-color"]="black"),"pink"===e&&(s["background-color"]="black",s["border-radius"]="50%",s.border="solid 3px crimson"),s}},computed:n()({},Object(c.c)("manager",["screenWidth","screenHeight","mapImgs","mapWidth","mapHeight"]),Object(c.b)("manager",["mapchipSize"]),{flameStyle:function(){return{width:this.mapchipSize*this.mapHeight+"px",height:this.mapchipSize*this.mapWidth+"px"}},marginStyle:function(){var t=(this.screenHeight-this.mapchipSize*this.mapWidth)/2,i=(this.screenWidth-this.mapchipSize*this.mapHeight)/2;return{"margin-top":t+"px","margin-bottom":t+"px","margin-left":i+"px","margin-right":i+"px"}}})},v={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"flame",style:[t.flameStyle,t.marginStyle]},[t._l(t.mapImgs,function(i,s){return e("div",{key:i.id,staticClass:"maprow"},t._l(i,function(t,i){return e("tile",{key:t.id,ref:"tile",refInFor:!0,attrs:{attr:{pos_r:s,pos_c:i}}})}),1)}),t._v(" "),e("ball",{ref:"ball"})],2)},staticRenderFns:[]};var w={name:"Main",components:{flame:e("VU/8")(g,v,!1,function(t){e("8v7q")},"data-v-f3d6d770",null).exports},data:function(){return{permission:!1}},computed:n()({},Object(c.c)("manager",["deltaTime","updateFlg","gyro","gameOver","gameClear"])),methods:{windowResize:function(){this.$store.dispatch("manager/setScreenSize",{width:window.innerWidth,height:window.innerHeight})},getDeviceGyro:function(t){this.$store.dispatch("manager/setDeviceGyro",{alpha:t.alpha,beta:t.beta,gamma:t.gamma})},run:function(){this.$refs.flame.run(),!0===this.gameOver&&this.$router.push("/"),!0===this.gameClear&&this.$router.push("/")}},watch:{updateFlg:function(){this.run()}},mounted:function(){var t=this;this.$store.dispatch("manager/setScreenSize",{width:window.innerWidth,height:window.innerHeight}),this.$store.dispatch("manager/setGameOver",!1),this.$store.dispatch("manager/setGameClear",!1),this.$store.dispatch("manager/loadMapChips").then(function(){t.$store.dispatch("manager/startUpdateAsync")}),window.addEventListener("resize",this.windowResize),window.addEventListener("deviceorientation",this.getDeviceGyro)},beforeDestroy:function(){window.removeEventListener("resize",this.windowResize),window.removeEventListener("deviceorientation",this.getDeviceGyro),this.$store.dispatch("manager/stopUpdateAsync")}},x={render:function(){var t=this.$createElement,i=this._self._c||t;return i("div",{staticClass:"content"},[i("flame",{ref:"flame"})],1)},staticRenderFns:[]};var S=e("VU/8")(w,x,!1,function(t){e("3EuY")},"data-v-09cd932a",null).exports,W=e("//Fk"),A=e.n(W),L={name:"Title",data:function(){return{message:"Controll Setting",doGyro:!1}},methods:{controllSetting:function(){var t=this;this.message="Checking Gyro Sensor ...",this.sensorVerification().then(function(){t.message="Gyro操作で開始します ...",t.$store.dispatch("manager/setControllType","gyro"),t.gameStart()}).catch(function(){window.DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?(t.message="センサーへのアクセスを承認してください",console.log("!"),t.requestDeviceSensor().then(function(){t.message="Gyro操作で開始します ...",t.$store.dispatch("manager/setControllType","gyro"),t.gameStart()}).catch(function(){})):(t.message="Keyboard操作で開始します...",t.$store.dispatch("manager/setControllType","keyboard"),t.gameStart())})},sensorVerification:function(){var t=this;return window.addEventListener("deviceorientation",this.checkSensor,!1),new A.a(function(i,e){setTimeout(function(){!0===t.doGyro?i():(window.removeEventListener("deviceorientation",t.checkSensor,!1),e(new Error("gyro doesnot work")))},1e3)})},checkSensor:function(t){console.log("verify gyro"),console.log(t),0!==t.alpha&&null!==t.alpha&&0!==t.beta&&null!==t.beta&&0!==t.gamma&&null!==t.gamma&&(this.doGyro=!0,window.removeEventListener("deviceorientation",this.checkSensor))},requestDeviceSensor:function(){return new A.a(function(t,i){DeviceOrientationEvent.requestPermission().then(function(e){"granted"===e?t():i(new Error("sensor request is rejected"))}).catch(function(){i(new Error("request error"))})})},gameStart:function(){var t=this;setTimeout(function(){t.$router.push("/game")},1e3)}}},M={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"content"},[e("button",{staticClass:"start",on:{click:function(i){return t.controllSetting()}}},[t._v(t._s(this.message))]),t._v(" "),t._m(0)])},staticRenderFns:[function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"note"},[e("table",{staticClass:"txt"},[e("tr",[e("th",[t._v("ジャイロ操作を行う場合")])]),t._v(" "),e("tr",[e("td",[t._v("・iOS13+/safari")]),e("td",[t._v("STARTボタンを押し，センサーへのアクセスを許可してください")])]),t._v(" "),e("tr",[e("td",[t._v("・iOS12-/safari")]),e("td",[t._v("「設定アプリ」などからセンサーへのアクセスを許可してください")])]),t._v(" "),e("tr",[e("td",[t._v("・その他のOS/ブラウザ")]),e("td",[t._v("STARTボタンを押すと自動で設定されます")])])])])}]};var b=e("VU/8")(L,M,!1,function(t){e("6O74")},"data-v-0a5a2812",null).exports;s.a.use(o.a);var z=new o.a({routes:[{path:"/",name:"Title",component:b},{path:"/game",name:"Main",component:S}]}),H={namespaced:!0,state:{fps:60,deltaTime:0,intervalID:void 0,updateFlg:!0,screenWidth:void 0,screenHeight:void 0,mapchips:[],mapImgs:[],mapWidth:void 0,mapHeight:void 0,startPos:{x:0,y:0},gameOver:!1,gameClear:!1,gyroAvailable:!1,gyro:{alpha:0,beta:0,gamma:0},controllType:"gyro",isAvailableGyro:!0,tileEffectQueue:[]},actions:{initState:function(t){t.commit,t.state},setDeviceGyro:function(t,i){var e=t.commit,s=(t.state,i.alpha),a=i.beta,h=i.gamma;console.log("getDeviceGyro"),e("setDeviceGyro",{alpha:s,beta:a,gamma:h})},startUpdateAsync:function(t){var i=t.commit,e=t.state;i("setDeltaTime",1/e.fps);var s=setInterval(function(){i("inversionUpdateFlg")},1e3/e.fps);i("setIntervalID",s)},stopUpdateAsync:function(t){t.commit;var i=t.state;clearInterval(i.intervalID)},setScreenSize:function(t,i){var e=t.commit,s=(t.state,i.width),a=i.height;e("setScreenWidth",s),e("setScreenHeight",a)},loadMapChips:function(t){var i=t.commit;t.state;i("setMapChips",[["WALL","WALL","WALL","WALL","WALL","WALL","WALL"],["WALL","AIR","AIR","AIR","AIR","WALL","WALL"],["WALL","AIR","AIR","AIR","BAN","AIR","WALL"],["WALL","AIR","AIR","BAN","AIR","AIR","WALL"],["WALL","AIR","BAN","AIR","AIR","AIR","WALL"],["WALL","WALL","AIR","AIR","AIR","GOAL","WALL"],["WALL","WALL","WALL","WALL","WALL","WALL","WALL"]]),i("setMapImages",[["wall1","wall1","wall1","wall1","wall1","wall1","wall1"],["wall1","air1","air1","air1","air1","wall1","wall1"],["wall1","air1","air1","air1","ban1","air1","wall1"],["wall1","air1","air1","ban1","air1","air1","wall1"],["wall1","air1","ban1","air1","air1","air1","wall1"],["wall1","wall1","air1","air1","air1","goal1","wall1"],["wall1","wall1","wall1","wall1","wall1","wall1","wall1"]]),i("setStartPos",{x:1,y:1})},setControllType:function(t,i){var e=t.commit;t.state;e("setControllType",i)},setGameOver:function(t,i){(0,t.commit)("setGameOver",i)},setGameClear:function(t,i){(0,t.commit)("setGameClear",i)}},getters:{mapchipSize:function(t){return Math.min(t.screenWidth/t.mapWidth,t.screenHeight/t.mapHeight)}},mutations:{inversionUpdateFlg:function(t){t.updateFlg=!t.updateFlg},setDeltaTime:function(t,i){t.deltaTime=i},setIntervalID:function(t,i){t.intervalID=i},setScreenHeight:function(t,i){t.screenHeight=i},setScreenWidth:function(t,i){t.screenWidth=i},setMapChips:function(t,i){t.mapchips=i,t.mapWidth=i[0].length,t.mapHeight=i.length},setMapImages:function(t,i){t.mapImgs=i},setStartPos:function(t,i){t.startPos=i},setDeviceGyro:function(t,i){t.gyro.alpha=null==i.alpha?0:i.alpha,t.gyro.beta=null==i.beta?0:i.beta,t.gyro.gamma=null==i.gamma?0:i.gamma,Math.abs(i.beta)<90?t.isAvailableGyro=!0:t.isAvailableGyro=!1},setControllType:function(t,i){t.controllType=i},setGameOver:function(t,i){t.gameOver=i},setGameClear:function(t,i){t.gameClear=i}}};s.a.use(c.a);var E=new c.a.Store({modules:{manager:H}});s.a.config.productionTip=!1,new s.a({el:"#app",router:z,store:E,components:{App:h},template:"<App/>"})},SCpU:function(t,i){}},["NHnr"]);
//# sourceMappingURL=app.7d0444ec12c2b7347c11.js.map