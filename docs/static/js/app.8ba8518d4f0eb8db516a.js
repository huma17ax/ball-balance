webpackJsonp([1],{"6O74":function(t,e){},JrGn:function(t,e){},NHnr:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("7+uW"),a={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]};var o=i("VU/8")({name:"App"},a,!1,function(t){i("JrGn")},null,null).exports,h=i("/ocq"),n=i("Dd8w"),r=i.n(n),c=i("NYxO"),p={name:"Ball",data:function(){return{pos:{x:0,y:0},velocity:{x:0,y:0},keyForce:240,friction:96,repulsion:.5,collisionPoint:10,pressedKey:{}}},computed:r()({},Object(c.c)("manager",["deltaTime","updateFlg","screenWidth","screenHeight","mapchips","mapWidth","mapHeight","startPos","controllType","gyro","isAvailableGyro"]),Object(c.b)("manager",["mapchipSize"]),{posStyle:function(){return{top:"calc("+this.pos.y+"% - "+this.ballSize/2+"px)",left:"calc("+this.pos.x+"% - "+this.ballSize/2+"px)"}},ballSize:function(){return this.mapchipSize/2}}),watch:{startPos:function(){this.pos.x=100*(this.startPos.x+.5)/this.mapWidth,this.pos.y=100*(this.startPos.y+.5)/this.mapHeight}},methods:{dotsStyle:function(t,e){return{top:"calc("+e+"% - 2px)",left:"calc("+t+"% - 2px)"}},Rec2Pol:function(t,e){var i=Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),s=Math.atan(e/t);return t<0&&(s+=Math.PI),t>=0&&e<0&&(s+=2*Math.PI),{c:i,deg:s}},Pol2Rec:function(t,e){return{x:t*Math.cos(e),y:t*Math.sin(e)}},run:function(){var t={x:0,y:0};if("keyboard"===this.controllType&&(this.pressedKey.DownArrow&&(t.y+=this.keyForce),this.pressedKey.UpArrow&&(t.y-=this.keyForce),this.pressedKey.LeftArrow&&(t.x-=this.keyForce),this.pressedKey.RightArrow&&(t.x+=this.keyForce)),"gyro"===this.controllType&&!0===this.isAvailableGyro&&(t.x+=this.keyForce*this.gyro.gamma/90,t.y+=this.keyForce*this.gyro.beta/90),0!==this.velocity.x||0!==this.velocity.y){var e=Math.sqrt(Math.pow(this.velocity.x,2)+Math.pow(this.velocity.y,2));t.x-=this.friction*this.velocity.x/e,t.y-=this.friction*this.velocity.y/e}var i=this.velocity.x+t.x*this.deltaTime,s=this.velocity.y+t.y*this.deltaTime;i*this.velocity.x<0&&s*this.velocity.y<0||i*this.velocity.x<0&&0===s&&0===this.velocity.y||0===i&&0===this.velocity.x&&s*this.velocity.y<0?(this.velocity.x=0,this.velocity.y=0):(this.velocity.x=i,this.velocity.y=s);var a=100/this.mapHeight*this.ballSize/this.mapchipSize/2,o=100/this.mapWidth*this.ballSize/this.mapchipSize/2,h=this.pos.x,n=this.pos.y-a;"WALL"===this.mapchips[Math.floor(n/100*this.mapHeight)][Math.floor(h/100*this.mapWidth)]&&(this.pos.y=100*(Math.floor(n/100*this.mapHeight)+1)/this.mapHeight+a,this.velocity.y=-this.velocity.y*this.repulsion);var r=this.pos.x,c=this.pos.y+a;"WALL"===this.mapchips[Math.floor(c/100*this.mapHeight)][Math.floor(r/100*this.mapWidth)]&&(this.pos.y=100*Math.floor(c/100*this.mapHeight)/this.mapHeight-a,this.velocity.y=-this.velocity.y*this.repulsion);var p=this.pos.x-o,l=this.pos.y;"WALL"===this.mapchips[Math.floor(l/100*this.mapHeight)][Math.floor(p/100*this.mapWidth)]&&(this.pos.x=100*(Math.floor(p/100*this.mapWidth)+1)/this.mapWidth+o,this.velocity.x=-this.velocity.x*this.repulsion);var m=this.pos.x+o,d=this.pos.y;"WALL"===this.mapchips[Math.floor(d/100*this.mapHeight)][Math.floor(m/100*this.mapWidth)]&&(this.pos.x=100*Math.floor(m/100*this.mapWidth)/this.mapWidth-o,this.velocity.x=-this.velocity.x*this.repulsion);var y=this.pos.x/100*this.mapWidth-Math.floor(this.pos.x/100*this.mapWidth)-.5,v=this.pos.y/100*this.mapHeight-Math.floor(this.pos.y/100*this.mapHeight)-.5,u=100*Math.floor(this.pos.x/100*this.mapWidth)/this.mapWidth+(y>0?100/this.mapWidth:0),g=100*Math.floor(this.pos.y/100*this.mapHeight)/this.mapHeight+(v>0?100/this.mapHeight:0),f="WALL"===this.mapchips[Math.floor(this.pos.y/100*this.mapHeight)+(v<0?-1:1)][Math.floor(this.pos.x/100*this.mapWidth)+(y<0?-1:1)];if(f=(f=f&&("AIR"===this.mapchips[Math.floor(this.pos.y/100*this.mapHeight)][Math.floor(this.pos.x/100*this.mapWidth)+(y<0?-1:1)]||"BAN"===this.mapchips[Math.floor(this.pos.y/100*this.mapHeight)][Math.floor(this.pos.x/100*this.mapWidth)+(y<0?-1:1)]))&&("AIR"===this.mapchips[Math.floor(this.pos.y/100*this.mapHeight)+(v<0?-1:1)][Math.floor(this.pos.x/100*this.mapWidth)]||"BAN"===this.mapchips[Math.floor(this.pos.y/100*this.mapHeight)+(v<0?-1:1)][Math.floor(this.pos.x/100*this.mapWidth)])){var w=this.mapchipSize*this.mapWidth*u/100,b=this.mapchipSize*this.mapHeight*g/100,A=this.mapchipSize*this.mapWidth*this.pos.x/100,x=this.mapchipSize*this.mapHeight*this.pos.y/100;if(Math.sqrt(Math.pow(w-A,2)+Math.pow(b-x,2))<this.ballSize/2){var L=this.Rec2Pol(this.mapchipSize*this.mapWidth*(this.pos.x-u)/100,this.mapchipSize*this.mapHeight*(this.pos.y-g)/100),W=this.Pol2Rec(this.ballSize/2,L.deg);if(this.pos.x=u+W.x/this.mapchipSize/this.mapWidth*100,this.pos.y=g+W.y/this.mapchipSize/this.mapHeight*100,0!==this.velocity.x&&0!==this.velocity.y){var S=this.Rec2Pol(this.velocity.x,this.velocity.y);W=this.Pol2Rec(S.c,S.deg-L.deg),S=this.Rec2Pol(-W.x*this.repulsion,W.y),W=this.Pol2Rec(S.c,S.deg+L.deg),this.velocity.x=W.x,this.velocity.y=W.y}}}this.pos.x+=this.velocity.x/2/this.mapWidth*this.deltaTime,this.pos.y+=this.velocity.y/2/this.mapHeight*this.deltaTime,"BAN"===this.mapchips[Math.floor(this.pos.y/100*this.mapHeight)][Math.floor(this.pos.x/100*this.mapWidth)]&&this.$store.dispatch("manager/setGameOver",!0)},KeyDown:function(t){40===t.keyCode&&(this.pressedKey.DownArrow=!0),38===t.keyCode&&(this.pressedKey.UpArrow=!0),39===t.keyCode&&(this.pressedKey.RightArrow=!0),37===t.keyCode&&(this.pressedKey.LeftArrow=!0)},KeyUp:function(t){40===t.keyCode&&(this.pressedKey.DownArrow=!1),38===t.keyCode&&(this.pressedKey.UpArrow=!1),39===t.keyCode&&(this.pressedKey.RightArrow=!1),37===t.keyCode&&(this.pressedKey.LeftArrow=!1)}},mounted:function(){window.addEventListener("keydown",this.KeyDown),window.addEventListener("keyup",this.KeyUp)}},l={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"ball",style:[t.posStyle,{height:t.ballSize+"px",width:t.ballSize+"px"}]}),t._v(" "),i("div",{staticClass:"vector",style:t.dotsStyle(t.pos.x+t.velocity.x/100,t.pos.y+t.velocity.y/100)})])},staticRenderFns:[]};var m={name:"flame",components:{ball:i("VU/8")(p,l,!1,function(t){i("pcjA")},"data-v-7709fcb2",null).exports},data:function(){return{}},methods:{run:function(){this.$refs.ball.run()},mapchipStyle:function(t,e){var i=this.mapImgs[t][e],s={width:this.mapchipSize+"px",height:this.mapchipSize+"px"};return"black"===i&&(s["background-color"]="black",s.border="solid 3px springgreen"),"white"===i&&(s["background-color"]="black"),"pink"===i&&(s["background-color"]="black",s["border-radius"]="50%",s.border="solid 3px crimson"),s}},computed:r()({},Object(c.c)("manager",["screenWidth","screenHeight","mapImgs","mapWidth","mapHeight"]),Object(c.b)("manager",["mapchipSize"]),{flameStyle:function(){return{width:this.mapchipSize*this.mapHeight+"px",height:this.mapchipSize*this.mapWidth+"px"}},marginStyle:function(){var t=(this.screenHeight-this.mapchipSize*this.mapWidth)/2,e=(this.screenWidth-this.mapchipSize*this.mapHeight)/2;return{"margin-top":t+"px","margin-bottom":t+"px","margin-left":e+"px","margin-right":e+"px"}}})},d={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"flame",style:[t.flameStyle,t.marginStyle]},[t._l(t.mapImgs,function(e,s){return i("div",{key:e.id,staticClass:"maprow"},t._l(e,function(e,a){return i("div",{key:e.id,staticClass:"mapchip",style:t.mapchipStyle(s,a)})}),0)}),t._v(" "),i("ball",{ref:"ball"})],2)},staticRenderFns:[]};var y={name:"Main",components:{flame:i("VU/8")(m,d,!1,function(t){i("fvE5")},"data-v-7d17bb0c",null).exports},data:function(){return{permission:!1}},computed:r()({},Object(c.c)("manager",["deltaTime","updateFlg","gyro","gameOver"])),methods:{windowResize:function(){this.$store.dispatch("manager/setScreenSize",{width:window.innerWidth,height:window.innerHeight})},getDeviceGyro:function(t){this.$store.dispatch("manager/setDeviceGyro",{alpha:t.alpha,beta:t.beta,gamma:t.gamma})},run:function(){this.$refs.flame.run(),!0===this.gameOver&&this.$router.push("/")}},watch:{updateFlg:function(){this.run()}},mounted:function(){var t=this;this.$store.dispatch("manager/setScreenSize",{width:window.innerWidth,height:window.innerHeight}),this.$store.dispatch("manager/setGameOver",!1),this.$store.dispatch("manager/loadMapChips").then(function(){t.$store.dispatch("manager/startUpdateAsync")}),window.addEventListener("resize",this.windowResize),window.addEventListener("deviceorientation",this.getDeviceGyro)},beforeDestroy:function(){window.removeEventListener("resize",this.windowResize),window.removeEventListener("deviceorientation",this.getDeviceGyro),this.$store.dispatch("manager/stopUpdateAsync")}},v={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"content"},[i("div",[t._v(" alpha: "+t._s(this.gyro.alpha)+" ")]),t._v(" "),i("div",[t._v(" beta: "+t._s(this.gyro.beta)+" ")]),t._v(" "),i("div",[t._v(" gamma: "+t._s(this.gyro.gamma)+" ")]),t._v(" "),i("flame",{ref:"flame"})],1)},staticRenderFns:[]};var u=i("VU/8")(y,v,!1,function(t){i("Ogua")},"data-v-3a212b8a",null).exports,g=i("//Fk"),f=i.n(g),w={name:"Title",data:function(){return{message:"Controll Setting",doGyro:!1}},methods:{controllSetting:function(){var t=this;this.message="Checking Gyro Sensor ...",this.sensorVerification().then(function(){t.message="Gyro操作で開始します ...",t.$store.dispatch("manager/setControllType","gyro"),t.gameStart()}).catch(function(){window.DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?(t.message="センサーへのアクセスを承認してください",console.log("!"),t.requestDeviceSensor().then(function(){t.message="Gyro操作で開始します ...",t.$store.dispatch("manager/setControllType","gyro"),t.gameStart()}).catch(function(){})):(t.message="Keyboard操作で開始します...",t.$store.dispatch("manager/setControllType","keyboard"),t.gameStart())})},sensorVerification:function(){var t=this;return window.addEventListener("deviceorientation",this.checkSensor,!1),new f.a(function(e,i){setTimeout(function(){!0===t.doGyro?e():(window.removeEventListener("deviceorientation",t.checkSensor,!1),i(new Error("gyro doesnot work")))},1e3)})},checkSensor:function(t){console.log("verify gyro"),console.log(t),0!==t.alpha&&null!==t.alpha&&0!==t.beta&&null!==t.beta&&0!==t.gamma&&null!==t.gamma&&(this.doGyro=!0,window.removeEventListener("deviceorientation",this.checkSensor))},requestDeviceSensor:function(){return new f.a(function(t,e){DeviceOrientationEvent.requestPermission().then(function(i){"granted"===i?t():e(new Error("sensor request is rejected"))}).catch(function(){e(new Error("request error"))})})},gameStart:function(){var t=this;setTimeout(function(){t.$router.push("/game")},1e3)}}},b={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"content"},[i("button",{staticClass:"start",on:{click:function(e){return t.controllSetting()}}},[t._v(t._s(this.message))]),t._v(" "),t._m(0)])},staticRenderFns:[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"note"},[i("table",{staticClass:"txt"},[i("tr",[i("th",[t._v("ジャイロ操作を行う場合")])]),t._v(" "),i("tr",[i("td",[t._v("・iOS13+/safari")]),i("td",[t._v("STARTボタンを押し，センサーへのアクセスを許可してください")])]),t._v(" "),i("tr",[i("td",[t._v("・iOS12-/safari")]),i("td",[t._v("「設定アプリ」などからセンサーへのアクセスを許可してください")])]),t._v(" "),i("tr",[i("td",[t._v("・その他のOS/ブラウザ")]),i("td",[t._v("STARTボタンを押すと自動で設定されます")])])])])}]};var A=i("VU/8")(w,b,!1,function(t){i("6O74")},"data-v-0a5a2812",null).exports;s.a.use(h.a);var x=new h.a({routes:[{path:"/",name:"Title",component:A},{path:"/game",name:"Main",component:u}]}),L={namespaced:!0,state:{fps:60,deltaTime:0,intervalID:void 0,updateFlg:!0,screenWidth:void 0,screenHeight:void 0,mapchips:[],mapImgs:[],mapWidth:void 0,mapHeight:void 0,startPos:{x:0,y:0},gyroAvailable:!1,gyro:{alpha:0,beta:0,gamma:0},controllType:"gyro",isAvailableGyro:!0,gameOver:!1},actions:{initState:function(t){t.commit,t.state},setDeviceGyro:function(t,e){var i=t.commit,s=(t.state,e.alpha),a=e.beta,o=e.gamma;console.log("getDeviceGyro"),i("setDeviceGyro",{alpha:s,beta:a,gamma:o})},startUpdateAsync:function(t){var e=t.commit,i=t.state;e("setDeltaTime",1/i.fps);var s=setInterval(function(){e("inversionUpdateFlg")},1e3/i.fps);e("setIntervalID",s)},stopUpdateAsync:function(t){t.commit;var e=t.state;clearInterval(e.intervalID)},setScreenSize:function(t,e){var i=t.commit,s=(t.state,e.width),a=e.height;i("setScreenWidth",s),i("setScreenHeight",a)},loadMapChips:function(t){var e=t.commit;t.state;e("setMapChips",[["WALL","WALL","WALL","WALL","WALL","WALL","WALL"],["WALL","AIR","AIR","AIR","AIR","AIR","WALL"],["WALL","AIR","WALL","AIR","WALL","AIR","WALL"],["WALL","AIR","AIR","BAN","AIR","AIR","WALL"],["WALL","AIR","WALL","AIR","WALL","AIR","WALL"],["WALL","AIR","AIR","AIR","AIR","AIR","WALL"],["WALL","WALL","WALL","WALL","WALL","WALL","WALL"]]),e("setMapImages",[["black","black","black","black","black","black","black"],["black","white","white","white","white","white","black"],["black","white","black","white","black","white","black"],["black","white","white","pink","white","white","black"],["black","white","black","white","black","white","black"],["black","white","white","white","white","white","black"],["black","black","black","black","black","black","black"]]),e("setStartPos",{x:1,y:1})},setControllType:function(t,e){var i=t.commit;t.state;i("setControllType",e)},setGameOver:function(t,e){(0,t.commit)("setGameOver",e)}},getters:{mapchipSize:function(t){return Math.min(t.screenWidth/t.mapWidth,t.screenHeight/t.mapHeight)}},mutations:{inversionUpdateFlg:function(t){t.updateFlg=!t.updateFlg},setDeltaTime:function(t,e){t.deltaTime=e},setIntervalID:function(t,e){t.intervalID=e},setScreenHeight:function(t,e){t.screenHeight=e},setScreenWidth:function(t,e){t.screenWidth=e},setMapChips:function(t,e){t.mapchips=e,t.mapWidth=e[0].length,t.mapHeight=e.length},setMapImages:function(t,e){t.mapImgs=e},setStartPos:function(t,e){t.startPos=e},setDeviceGyro:function(t,e){t.gyro.alpha=null==e.alpha?0:e.alpha,t.gyro.beta=null==e.beta?0:e.beta,t.gyro.gamma=null==e.gamma?0:e.gamma,Math.abs(e.beta)<90?t.isAvailableGyro=!0:t.isAvailableGyro=!1},setControllType:function(t,e){t.controllType=e},setGameOver:function(t,e){t.gameOver=e}}};s.a.use(c.a);var W=new c.a.Store({modules:{manager:L}});s.a.config.productionTip=!1,new s.a({el:"#app",router:x,store:W,components:{App:o},template:"<App/>"})},Ogua:function(t,e){},fvE5:function(t,e){},pcjA:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.8ba8518d4f0eb8db516a.js.map